{
  "kind": "build_request",
  "title": "Fix blank screen after login - display role-specific dashboard content",
  "projectName": "Bina Yönetim ERP",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-92",
      "text": "Debug and fix the post-authentication routing flow in frontend/src/App.tsx to ensure users are correctly redirected to their role-specific dashboards (OwnerDashboard, ManagerDashboard, or ResidentDashboard) after Internet Identity authentication completes, preventing the blank screen issue",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "hala giriş yaptıktan sonraki wkran boş geliyot"
        ]
      },
      "acceptanceCriteria": [
        "After successful Internet Identity login, users with BINA_SAHIBI role are redirected to /owner-dashboard and see dashboard content",
        "After successful Internet Identity login, users with YETKILI role are redirected to /manager-dashboard and see dashboard content",
        "After successful Internet Identity login, users with SAKIN role are redirected to /resident-dashboard and see dashboard content",
        "No blank screen appears after authentication completes",
        "Console logs track the authentication state, user role fetching, and routing decisions for debugging"
      ]
    },
    {
      "id": "REQ-93",
      "text": "Verify that the user profile query in frontend/src/App.tsx properly fetches the authenticated user's role and building association immediately after Internet Identity authentication, with proper error handling for failed profile fetches",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "hala giriş yaptıktan sonraki wkran boş geliyot"
        ]
      },
      "acceptanceCriteria": [
        "User profile data (including role and binaId) is fetched immediately after authentication",
        "Profile fetch errors are logged and displayed to users in Turkish",
        "Loading states are properly handled while profile data is being fetched",
        "Role-based routing waits for profile data before making redirect decisions"
      ]
    },
    {
      "id": "REQ-94",
      "text": "Add defensive checks in the role-specific dashboard components (OwnerDashboard.tsx, ManagerDashboard.tsx, ResidentDashboard.tsx) to handle cases where user profile data is missing or incomplete, displaying appropriate loading states or error messages in Turkish",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "hala giriş yaptıktan sonraki wkran boş geliyot"
        ]
      },
      "acceptanceCriteria": [
        "Dashboard components display loading skeletons while profile data is being fetched",
        "Dashboard components show Turkish error messages when profile data fails to load",
        "Dashboard components gracefully handle null/undefined user data",
        "Users see meaningful feedback instead of blank screens"
      ]
    },
    {
      "id": "REQ-95",
      "text": "Fix the onboarding flow handling in frontend/src/pages/Home.tsx to ensure the component properly renders onboarding UI for new users without buildings, and role-based dashboard content for existing users with building assignments",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "hala giriş yaptıktan sonraki wkran boş geliyot"
        ]
      },
      "acceptanceCriteria": [
        "New users without building assignment see the onboarding section with 'Bina Oluştur' or 'Davet Kodu Gir' options",
        "Users with building assignment and valid roles see appropriate role-based content",
        "Home page does not render blank when user profile is loaded",
        "Session storage onboarding flow values are properly retrieved and used"
      ]
    },
    {
      "id": "REQ-96",
      "text": "Verify that the React Query cache invalidation logic properly refreshes user profile data after building creation, invite code registration, and role assignment operations to ensure UI updates reflect the latest user state",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "hala giriş yaptıktan sonraki wkran boş geliyot"
        ]
      },
      "acceptanceCriteria": [
        "After building creation, user profile is re-fetched and UI updates to show role-based dashboard",
        "After invite code registration, user profile is re-fetched and UI updates to show role-based dashboard",
        "Cache invalidation occurs automatically after successful mutations",
        "No manual page refresh is required to see updated user state"
      ]
    }
  ],
  "constraints": [
    "Do not modify backend/main.mo authentication or user profile logic",
    "Do not change the Internet Identity integration in frontend/src/hooks/useInternetIdentity.ts",
    "Maintain existing Turkish language labels and error messages",
    "Keep role-based access control permissions as currently defined"
  ],
  "nonGoals": [
    "Adding new authentication methods beyond Internet Identity",
    "Changing the role hierarchy or permission system",
    "Redesigning dashboard layouts or visual components",
    "Adding new features to dashboards"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}